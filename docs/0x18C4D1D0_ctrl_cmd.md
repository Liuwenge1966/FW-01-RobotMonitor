# 运动指令控制帧（ctrl_cmd）协议说明

## 基本信息

- **报文名称**：`ctrl_cmd`  
- **发送节点**：决策控制单元  
- **接收节点**：底盘节点  
- **Msg ID**：`0x18C4D1D0`  
- **周期**：20 ms（每 20 毫秒发送一次）  
- **接收超时**：无（不设置超时机制）  
- **报文长度**：8 字节  
- **起始字节**：`byte[0]`

---

## 字段解析

| 字节位置 | 字段名称             | 数据类型  | 起始位 | 信号长度（bit） | 说明 |
|----------|----------------------|-----------|--------|------------------|------|
| byte [0] | 目标档位             | Unsigned  | 0      | 4                | 档位控制：<br>• `00`: disable（禁用）<br>• `01`: 驻车档<br>• `02`: 空挡<br>• `04`: FR-档（未启用）<br>• `06`: 4T4D-档<br>• `07`: 横移-档 |
| byte [0] | 目标车体线速度       | Signed    | 4      | 16               | 单位：`0.001 m/s/bit`<br>正负值表示前进或后退方向 |
| byte [2] | 目标车体角速度       | Signed    | 20     | 16               | 单位：`0.01°/s/bit`<br>正负值表示顺时针或逆时针旋转 |
| byte [4] | 目标车体侧偏角       | Signed    | 36     | 16               | 单位：`0.01°/bit`<br>表示车辆相对于目标方向的侧向偏转角度 |
| byte [6] | Alive Rolling Counter | Unsigned | 52     | 4                | 心跳信号 / 循环计数器：<br>每帧递增 1，溢出后归零，用于检测通信状态 |
| byte [7] | Check BCC            | Unsigned  | 56     | 8                | 消息异或校验（通常为所有字节的 XOR 结果），用于验证数据完整性 |

> **注**：起始位为整个报文从 `bit 0` 开始的绝对位偏移。

---

## 补充说明

- **高实时性**：报文周期为 20ms，确保底盘控制指令的及时响应。
- **数据编码**：所有数值均以二进制补码（Signed）或无符号整数（Unsigned）形式编码，需根据起始位和长度正确解析。
- **心跳机制**：`Alive Rolling Counter` 是关键的安全监控信号，若接收端检测到计数器停滞或跳变异常，可判定通信故障。
- **校验机制**：`Check BCC` 用于防止数据在传输过程中被篡改或损坏，建议接收端进行校验比对。

---

## 总结

`ctrl_cmd` 报文是自动驾驶系统中**决策控制单元**向**底盘执行单元**下发的核心运动控制指令，包含：

- 档位选择
- 线速度、角速度、侧偏角目标值
- 通信心跳与数据校验

该设计兼顾**实时性、安全性与可靠性**，适用于智能车辆的底层运动控制场景。