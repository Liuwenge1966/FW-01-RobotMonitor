# 转向控制指令帧（steering_ctrl_cmd）协议说明

## 基本信息

- **报文名称**：`steering_ctrl_cmd`  
- **发送节点**：决策控制单元  
- **接收节点**：底盘节点  
- **Msg ID**：`0x18C4D2D0`  
- **周期**：20 ms（每 20 毫秒发送一次）  
- **接收超时**：无（不设置超时机制）  
- **报文长度**：8 字节  
- **起始字节**：`byte[0]`

---

## 字段解析

| 字节位置 | 功能字段               | 数据类型  | 起始位 | 信号长度（bit） | 说明 |
|----------|------------------------|-----------|--------|------------------|------|
| byte [0] | 目标档位               | Unsigned  | 0      | 4                | 档位控制：<br>• `00`: disable（禁用）<br>• `01`: 驻车档<br>• `02`: 空挡<br>• `03`: FR-档（未启用）<br>• `05`: 4T4D-档<br>• `07`: 横移-档 |
| byte [0] | 目标车体速度           | Signed    | 4      | 16               | 单位：`0.001 m/s/bit`<br>正负值表示前进或后退方向 |
| byte [2] | 目标车体转向角         | Signed    | 20     | 16               | 单位：`0.01°/bit`<br>表示车辆期望的转向角度（左转为负，右转为正） |
| byte [4] | 目标车体侧偏角         | Signed    | 36     | 16               | 单位：`0.01°/bit`<br>表示车辆相对于目标方向的横向偏转角度 |
| byte [6] | Alive Rolling Counter（心跳信号 / 循环计数器） | Unsigned | 52     | 4                | 每发送一帧，数值加 1；达到最大值后从 0 开始重新计数。<br>用于检测通信是否丢包或链路异常。 |
| byte [7] | Check BCC（消息异或校验） | Unsigned | 56     | 8                | 校验位，通常为所有字节的异或（XOR）结果，用于验证数据完整性 |

> **注**：起始位为整个报文从 `bit 0` 开始的绝对位偏移。例如，`byte[0]` 的第 4 位开始是“目标车体速度”的最低有效位（LSB）。

---

## 补充说明

### 1. **报文周期与实时性**
- 报文周期为 **20ms**，确保控制系统具备高实时响应能力，适用于自动驾驶或智能驾驶场景中的动态控制需求。

### 2. **档位定义差异**
- 与之前 `ctrl_cmd` 报文相比，该报文的档位定义略有不同：
  - `03`: FR-档（未启用）
  - `05`: 4T4D-档
  - `07`: 横移-档
- 说明系统支持多种驾驶模式，如横移、四轮驱动等特殊工况。

### 3. **转向角控制**
- “目标车体转向角” 是本帧的核心控制量之一，用于实现精确路径跟踪和转向控制。
- 单位为 `0.01°/bit`，精度较高，适合高阶自动驾驶系统。

### 4. **心跳与校验机制**
- **Alive Rolling Counter**：关键安全机制，用于判断通信是否正常。若连续多帧未收到或计数器未递增，则判定通信中断。
- **Check BCC**：提供基本的数据校验功能，防止传输错误导致误操作。

---

## 总结

`steering_ctrl_cmd` 是由 **决策控制单元** 向 **底盘节点** 发送的**转向与运动控制指令帧**，主要功能包括：

- 设置目标档位
- 控制目标车速
- 指定目标转向角和侧偏角
- 提供通信心跳与数据校验

该报文结构紧凑、信息完整，适用于需要高精度转向控制的智能车辆系统，具有良好的实时性与安全性设计。