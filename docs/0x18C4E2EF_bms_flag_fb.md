# 电池管理系统状态标志反馈帧（bms_flag_fb）协议说明

## 基本信息

- **报文名称**：`bms_flag_fb`  
- **发送节点**：线控底盘  
- **接收节点**：决策控制单元  
- **Msg ID**：`0x18C4E2EF`  
- **周期**：100 ms（每 100 毫秒发送一次）  
- **接收超时**：无（不设置超时机制）  
- **报文长度**：8 字节  
- **起始字节**：`byte[0]`

> **注**：此帧为 **底盘向决策单元上报的电池管理系统（BMS）状态标志与关键参数反馈**，用于监控电池健康状态、安全保护状态及温度信息。

---

## 字段解析

| 字节位置 | 功能字段                     | 数据类型  | 起始位 | 信号长度（bit） | 说明 |
|----------|------------------------------|-----------|--------|------------------|------|
| byte [0] | 当前剩余电量百分比           | Unsigned  | 0      | 8                | 单位：`1%/bit`，范围 0~100%<br>表示当前电池 SOC（State of Charge） |
| byte [1] | 单体过压保护                 | Unsigned  | 8      | 1                | `0`: 关闭，`1`: 打开（触发单体过压保护） |
| byte [1] | 单体欠压保护                 | Unsigned  | 9      | 1                | `0`: 关闭，`1`: 打开（触发单体欠压保护） |
| byte [1] | 整组过压保护                 | Unsigned  | 10     | 1                | `0`: 关闭，`1`: 打开（触发整组过压保护） |
| byte [1] | 整组欠压保护                 | Unsigned  | 11     | 1                | `0`: 关闭，`1`: 打开（触发整组欠压保护） |
| byte [1] | 充电过温保护                 | Unsigned  | 12     | 1                | `0`: 关闭，`1`: 打开（充电时温度过高） |
| byte [1] | 充电低温保护                 | Unsigned  | 13     | 1                | `0`: 关闭，`1`: 打开（充电时温度过低） |
| byte [1] | 放电过温保护                 | Unsigned  | 14     | 1                | `0`: 关闭，`1`: 打开（放电时温度过高） |
| byte [1] | 放电低温保护                 | Unsigned  | 15     | 1                | `0`: 关闭，`1`: 打开（放电时温度过低） |
| byte [2] | 充电过流保护                 | Unsigned  | 16     | 1                | `0`: 关闭，`1`: 打开（充电电流过大） |
| byte [2] | 放电过流保护                 | Unsigned  | 17     | 1                | `0`: 关闭，`1`: 打开（放电电流过大） |
| byte [2] | 短路保护                     | Unsigned  | 18     | 1                | `0`: 关闭，`1`: 打开（检测到短路） |
| byte [2] | 前端检测 IC 错误             | Unsigned  | 19     | 1                | `0`: 关闭，`1`: 打开（前端检测电路故障） |
| byte [2] | 软件锁定 MOS                 | Unsigned  | 20     | 1                | `0`: 关闭，`1`: 打开（软件强制关闭功率管） |
| byte [2] | 充电标志位                   | Unsigned  | 21     | 1                | `0`: 放电状态，`1`: 充电状态 |
| byte [1] | 当前电池最高温度             | Signed    | 28     | 12               | 单位：`0.1°C/bit`，范围 ±2047°C（实际使用中通常为 0~100°C） |
| byte [1] | 当前电池最低温度             | Signed    | 40     | 12               | 单位：`0.1°C/bit`，范围 ±2047°C（实际使用中通常为 0~100°C） |
| byte [6] | Alive Rolling Counter（心跳信号 / 循环计数器） | Unsigned | 52     | 4                | 每发一帧，数值加 1；达到最大值后从 0 重新开始。<br>用于检测通信是否丢包或链路异常。 |
| byte [7] | Check BCC（消息异或校验）    | Unsigned | 56     | 8                | 校验位，通常为所有字节的异或（XOR）结果，用于验证数据完整性 |

> **注**：
> - 多个字段共用同一字节（如 `byte[1]` 和 `byte[2]`），需通过起始位进行位域划分。
> - 温度字段占用 12 位，位于 `byte[1]` 的高 12 位（bit 28~39 和 bit 40~51），分别对应最高和最低温度。

---

## 补充说明

### 1. **中低频反馈**
- 报文周期为 **100ms**，属于中低频反馈帧，适用于电池状态监控等非实时性要求较高的场景。
- 适合用于电池健康状态评估、能量管理策略制定和安全预警。

### 2. **全面的电池保护状态**
- 提供了完整的 **BMS 保护机制状态反馈**，包括：
  - 过压/欠压保护（单体 & 整组）
  - 过温/低温保护（充电 & 放电）
  - 过流保护（充/放电）
  - 短路、IC 错误、MOS 锁定等故障状态
- 可用于：
  - 安全策略判断
  - 故障诊断与报警
  - 自动停机或限功率运行

### 3. **温度监控**
- 提供当前电池组的 **最高温度** 和 **最低温度**，单位为 `0.1°C/bit`，精度较高。
- 支持热管理系统的优化设计，防止局部过热导致安全隐患。

### 4. **电量与工作模式**
- **SOC 百分比**：直接反映电池可用能量，是能量管理的核心输入。
- **充电标志位**：指示当前处于充电还是放电状态，用于协调整车控制逻辑。

### 5. **心跳与校验机制**
- **Alive Rolling Counter**：每帧递增，用于判断通信是否正常。若连续多帧未收到或计数器未变化，则判定通信中断。
- **Check BCC**：提供基本的数据校验能力，防止传输错误导致误判。

---

## 总结

`bms_flag_fb` 是由 **线控底盘** 向 **决策控制单元** 发送的 **电池管理系统状态标志反馈帧**，其核心功能包括：

- 上报当前电池 SOC（剩余电量百分比）
- 反馈多种电池保护状态（过压、过温、过流等）
- 提供电池最高/最低温度
- 包含心跳信号与数据校验

该帧具有 **良好的安全性** 和 **可靠性**，是实现智能车辆电池管理、能量调度与安全防护的关键组成部分。